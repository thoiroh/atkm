<div class="terminal-wrapper">
  <header class="terminal-header">
    <h1>Binance Account NEW Assets Inventory</h1>
    <div class="terminal-details">
      <h2>Binance account information & assets inventory.</h2>
    </div>
  </header>
  <!-- État de chargement -->
  @if (loading() && !account()) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des informations du compte...</p>
  </div>
  }
  <!-- État d'erreur -->
  @if (error()) {
  <div class="error-state">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
      <path
        d="M2.343 13.657A8 8 0 1 1 13.657 2.343 8 8 0 0 1 2.343 13.657ZM6.03 4.97a.751.751 0 0 0-1.042.018.751.751 0 0 0-.018 1.042L6.94 8 4.97 9.97a.749.749 0 0 0 .326 1.275.749.749 0 0 0 .734-.215L8 9.06l1.97 1.97a.749.749 0 0 0 1.275-.326.749.749 0 0 0-.215-.734L9.06 8l1.97-1.97a.749.749 0 0 0-.326-1.275.749.749 0 0 0-.734.215L8 6.94Z" />
    </svg>
    <p>{{ error() }}</p>
    <button class="retry-btn" (click)="refreshAccount()">Réessayer</button>
  </div>
  }

  <!-- Informations du compte -->
  @if (account(); as currentAccount) {
  <div class="terminal-main">
    <!-- Informations générales -->
    <div class="terminal-section">
      <div class="section-content">
        <atk-icon class="terminal-toggle" name="triangle-right" color="var(--color-btn-bg-default)" />
        <atk-bash configId="binance-debug-v2" [autoLoad]="true" (dataLoaded)="onBashDataLoaded($event)"
          (errorOccurred)="onBashError($event)" />
      </div>
      <!-- (configRequest)="onBashConfigRequest($event)" -->
      <div class="terminal-section">
        <div class="infos-items">
          <div class="infos-item" [class.enabled]="currentAccount.canTrade">
            <atk-icon name="check" color="#ef4444" [size]="24" />
            <span>Trading</span>
            <span class="status">{{ currentAccount.canTrade ? 'Activé' : 'Désactivé' }}</span>
          </div>
          <div class="infos-item" [class.enabled]="currentAccount.canWithdraw">
            <atk-icon name="check" color="#ef4444" [size]="24" />
            <span>Retrait</span>
            <span class="status">{{ currentAccount.canWithdraw ? 'Activé' : 'Désactivé' }}</span>
          </div>
          <div class="infos-item" [class.enabled]="currentAccount.canDeposit">
            <atk-icon name="check" color="#ef4444" [size]="24" />
            <span>Dépôt</span>
            <span class="status">{{ currentAccount.canDeposit ? 'Activé' : 'Désactivé' }}</span>
          </div>
        </div>
        <div class="terminal-cmd">
          <div class="cmd-item">
            <label>Type de compte</label>
            <span class="cmd-text">{{ currentAccount.accountType }}</span>
          </div>
          <div class="cmd-item">
            <label>Dernière mise à jour</label>
            <span class="cmd-text">{{ formatUpdateTime(currentAccount.updateTime) }}</span>
          </div>
          @if (currentAccount.permissions.length > 0) {
          <div class="cmd-item">
            <label>Permissions supplémentaires</label>
            <div class="cmd-tags">
              @for (permission of currentAccount.permissions; track permission) {
              <span class="cmd-tag" [ngClass]="getPermissionClass(permission)">
                {{ permission }}
              </span>
              }
            </div>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Soldes des actifs -->
    <div class="terminal-section">
      <atk-icon class="terminal-toggle" name="triangle-right" color="var(--color-btn-bg-default)" />
      <div class="infos-title">
        <h2>Soldes des actifs</h2>
      </div>
      @if (significantBalances().length === 0) {
      <div class="no-balances">
        <p>Aucun actif avec solde disponible</p>
      </div>
      }
      @if (significantBalances().length > 0) {
      <div class="terminal-table">
        <div class="table-header">
          <div class="header-cell left">Actif</div>
          <div class="header-cell right">Disponible</div>
          <div class="header-cell right">Bloqué</div>
          <div class="header-cell right">Total</div>
        </div>
        @for (balance of significantBalances(); track trackByAsset($index, balance)) {
        <div class="balance-row">
          <div class="balance-cell asset-cell">
            <span class="asset-name">{{ balance.asset }}</span>
          </div>
          <div class="balance-cell amount-cell">
            <span class="amount">{{ formatBalance(balance.free) }}</span>
          </div>
          <div class="balance-cell amount-cell">
            <span class="amount locked" [class.has-locked]="balance.locked > 0">
              {{ formatBalance(balance.locked) }}
            </span>
          </div>
          <div class="balance-cell amount-cell total-cell">
            <span class="amount total">{{ formatBalance(balance.total) }}</span>
          </div>
        </div>
        }
      </div>
      }
    </div>
    <!-- <atk-sidebar-bash-config [bashConfig]="bashConfig()" [terminalState]="bashTerminalState()"
      [isCollapsed]="bashConfigPanelCollapsed()" [currentEndpoint]="bashCurrentEndpoint()"
      (configChange)="onBashConfigChange($event)" (togglePanel)="toggleBashConfigPanel()" /> -->
  </div>
  }
</div>
