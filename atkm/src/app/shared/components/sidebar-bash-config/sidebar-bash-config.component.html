<aside class="bash-config-panel" [class.collapsed]="isCollapsed()" [class.expanded]="!isCollapsed()">
  <button class="bash-config-toggle" (click)="onToggle()"
    [attr.aria-label]="isCollapsed() ? 'Open configuration' : 'Close configuration'">
    @if (!isCollapsed()) {
    <atk-icon class="toggle-arrow right" name="triangle-right" [size]="16" color="#656d76"></atk-icon>
    } @else {
    <atk-icon class="toggle-arrow left" name="triangle-left" [size]="16" color="#656d76"></atk-icon>
    }
  </button>

  <div class="bash-config-wrapper">
    <div class="config-content">
      <div class="config-section">
        <header class="config-header">
          <h3 class="panel-title">
            <atk-icon name="terminal" [size]="18" color="var(--color-accent-fg)"></atk-icon>
            Terminal Control
          </h3>

          <!-- Connection Status -->
          <div class="connection-status" [class]="connectionStatus()">
            <span class="status-indicator" [class]="connectionStatus()">
              @switch (connectionStatus()) {
              @case ('connected') {
              <atk-icon name="wifi" [size]="14" color="var(--color-success-emphasis)"></atk-icon>
              }
              @case ('connecting') {
              <atk-icon name="loader" [size]="14" color="var(--color-accent-fg)"></atk-icon>
              }
              @default {
              <atk-icon name="wifi-off" [size]="14" color="var(--color-fg-muted)"></atk-icon>
              }
              }
            </span>
            <span class="status-text">{{ connectionStatus() | titlecase }}</span>
            @if (isLoading()) {
            <span class="loading-spinner"></span>
            }
          </div>
        </header>
        <!-- Tab Navigation -->
        <nav class="bash-config-tabs">
          <button class="tab-button" [class.active]="activeTab() === 'endpoints'" (click)="setActiveTab('endpoints')">
            <atk-icon name="server" [size]="14" color="currentColor"></atk-icon>
            Endpoints
          </button>
          <button class="tab-button" [class.active]="activeTab() === 'parameters'" (click)="setActiveTab('parameters')">
            <atk-icon name="settings" [size]="14" color="currentColor"></atk-icon>
            Params
          </button>
          <button class="tab-button" [class.active]="activeTab() === 'terminal'" (click)="setActiveTab('terminal')">
            <atk-icon name="monitor" [size]="14" color="currentColor"></atk-icon>
            Terminal
          </button>
          <button class="tab-button" [class.active]="activeTab() === 'actions'" (click)="setActiveTab('actions')">
            <atk-icon name="zap" [size]="14" color="currentColor"></atk-icon>
            Actions
          </button>
        </nav>

        <!-- Search Bar -->
        <div class="bash-config-search">
          <div class="search-input-wrapper">
            <atk-icon name="search" [size]="14" color="var(--color-fg-muted)"></atk-icon>
            <input type="text" class="search-input" placeholder="Search configuration..." [value]="searchQuery()"
              (input)="onSearchChange($any($event.target).value)">
            @if (searchQuery()) {
            <button class="search-clear" (click)="onSearchChange('')">
              <atk-icon name="x" [size]="12" color="var(--color-fg-muted)"></atk-icon>
            </button>
            }
          </div>
        </div>

        <!-- Configuration Content -->
        <div class="bash-config-content">

          <!-- Endpoints Tab -->
          @if (activeTab() === 'endpoints') {
          <div class="config-tab-content">
            @for (section of filteredSections(); track section.id) {
            @if (section.id === 'endpoints') {
            <div class="bash-config-section">
              <button class="section-header" (click)="toggleSection(section.id)">
                <atk-icon [name]="section.icon" [size]="16" color="var(--color-fg-default)"></atk-icon>
                <span class="section-title">{{ section.title }}</span>
                <atk-icon name="chevron-down" [size]="14" color="var(--color-fg-muted)"
                  [class.rotated]="!section.isExpanded">
                </atk-icon>
              </button>

              @if (section.isExpanded) {
              <div class="section-content">
                @for (item of section.items; track item.id) {
                <div class="config-item">

                  <!-- Select Input -->
                  @if (item.type === 'select') {
                  <label class="item-label">{{ item.label }}</label>
                  <select class="item-select" [value]="item.id === 'current-endpoint' ? currentEndpoint() : item.value"
                    [disabled]="item.disabled || isLoading()"
                    (change)="item.id === 'current-endpoint' ? onEndpointChange($any($event.target).value) : onConfigItemChange(section.id, item.id, $any($event.target).value)">
                    @for (option of item.options; track option.value) {
                    <option [value]="option.value" [disabled]="option.disabled">
                      {{ option.label }}
                    </option>
                    }
                  </select>
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                  <!-- Toggle Input -->
                  @if (item.type === 'toggle') {
                  <div class="item-toggle-wrapper">
                    <label class="item-label">{{ item.label }}</label>
                    <label class="toggle-switch">
                      <input type="checkbox" [checked]="item.value" [disabled]="item.disabled || isLoading()"
                        (change)="onConfigItemChange(section.id, item.id, $any($event.target).checked)">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                  <!-- Range Input -->
                  @if (item.type === 'range') {
                  <label class="item-label">{{ item.label }} <span class="range-value">({{ item.value }})</span></label>
                  <input type="range" class="item-range" [min]="item.min" [max]="item.max" [step]="item.step"
                    [value]="item.value" [disabled]="item.disabled || isLoading()"
                    (input)="onConfigItemChange(section.id, item.id, +$any($event.target).value)">
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                </div>
                }
              </div>
              }
            </div>
            }
            }
          </div>
          }

          <!-- Parameters Tab -->
          @if (activeTab() === 'parameters') {
          <div class="config-tab-content">
            @for (section of filteredSections(); track section.id) {
            @if (section.id === 'parameters') {
            <div class="config-section">
              <button class="section-header" (click)="toggleSection(section.id)">
                <atk-icon [name]="section.icon" [size]="16" color="var(--color-fg-default)"></atk-icon>
                <span class="section-title">{{ section.title }}</span>
                <atk-icon name="chevron-down" [size]="14" color="var(--color-fg-muted)"
                  [class.rotated]="!section.isExpanded">
                </atk-icon>
              </button>

              @if (section.isExpanded) {
              <div class="section-content">
                @for (item of section.items; track item.id) {
                <div class="config-item">

                  @if (item.type === 'input') {
                  <label class="item-label">{{ item.label }}</label>
                  <input type="text" class="item-input" [value]="item.value" [placeholder]="item.placeholder"
                    [disabled]="item.disabled || isLoading()"
                    (input)="onParameterChange(item.id.replace('param-', ''), $any($event.target).value)">
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                  @if (item.type === 'button') {
                  <button class="item-button" [class]="'btn-' + (item.variant || 'secondary')"
                    [disabled]="item.disabled || isLoading()" (click)="executeAction(item.id)">
                    {{ item.label }}
                  </button>
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                </div>
                }
              </div>
              }
            </div>
            }
            }
          </div>
          }

          <!-- Terminal Tab -->
          @if (activeTab() === 'terminal') {
          <div class="config-tab-content">
            @for (section of filteredSections(); track section.id) {
            @if (section.id === 'terminal') {
            <div class="config-section">
              <button class="section-header" (click)="toggleSection(section.id)">
                <atk-icon [name]="section.icon" [size]="16" color="var(--color-fg-default)"></atk-icon>
                <span class="section-title">{{ section.title }}</span>
                <atk-icon name="chevron-down" [size]="14" color="var(--color-fg-muted)"
                  [class.rotated]="!section.isExpanded">
                </atk-icon>
              </button>

              @if (section.isExpanded) {
              <div class="section-content">
                @for (item of section.items; track item.id) {
                <div class="config-item">

                  @if (item.type === 'range') {
                  <label class="item-label">{{ item.label }} <span class="range-value">({{ item.value }})</span></label>
                  <input type="range" class="item-range" [min]="item.min" [max]="item.max" [step]="item.step"
                    [value]="item.value" [disabled]="item.disabled || isLoading()"
                    (input)="onConfigItemChange(section.id, item.id, +$any($event.target).value)">
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                  @if (item.type === 'toggle') {
                  <div class="item-toggle-wrapper">
                    <label class="item-label">{{ item.label }}</label>
                    <label class="toggle-switch">
                      <input type="checkbox" [checked]="item.value" [disabled]="item.disabled || isLoading()"
                        (change)="onConfigItemChange(section.id, item.id, $any($event.target).checked)">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                  @if (item.type === 'select') {
                  <label class="item-label">{{ item.label }}</label>
                  <select class="item-select" [value]="item.value" [disabled]="item.disabled || isLoading()"
                    (change)="onConfigItemChange(section.id, item.id, $any($event.target).value)">
                    @for (option of item.options; track option.value) {
                    <option [value]="option.value" [disabled]="option.disabled">
                      {{ option.label }}
                    </option>
                    }
                  </select>
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                </div>
                }
              </div>
              }
            </div>
            }
            }
          </div>
          }

          <!-- Actions Tab -->
          @if (activeTab() === 'actions') {
          <div class="config-tab-content">
            @for (section of filteredSections(); track section.id) {
            @if (section.id === 'actions') {
            <div class="config-section">
              <button class="section-header" (click)="toggleSection(section.id)">
                <atk-icon [name]="section.icon" [size]="16" color="var(--color-fg-default)"></atk-icon>
                <span class="section-title">{{ section.title }}</span>
                <atk-icon name="chevron-down" [size]="14" color="var(--color-fg-muted)"
                  [class.rotated]="!section.isExpanded">
                </atk-icon>
              </button>

              @if (section.isExpanded) {
              <div class="section-content">
                @for (item of section.items; track item.id) {
                <div class="config-item">

                  @if (item.type === 'button') {
                  <button class="item-button action-button" [class]="'btn-' + (item.variant || 'secondary')"
                    [disabled]="item.disabled || isLoading()" (click)="executeAction(item.id)">
                    @switch (item.id) {
                    @case ('clear-terminal') {
                    <atk-icon name="trash-2" [size]="14" color="currentColor"></atk-icon>
                    }
                    @case ('export-logs') {
                    <atk-icon name="download" [size]="14" color="currentColor"></atk-icon>
                    }
                    @case ('export-data') {
                    <atk-icon name="file-down" [size]="14" color="currentColor"></atk-icon>
                    }
                    @case ('test-connection') {
                    <atk-icon name="wifi" [size]="14" color="currentColor"></atk-icon>
                    }
                    @case ('reload-config') {
                    <atk-icon name="refresh-cw" [size]="14" color="currentColor"></atk-icon>
                    }
                    @default {
                    <atk-icon name="play" [size]="14" color="currentColor"></atk-icon>
                    }
                    }
                    {{ item.label }}
                  </button>
                  @if (item.description) {
                  <p class="item-description">{{ item.description }}</p>
                  }
                  }

                </div>
                }
              </div>
              }
            </div>
            }
            }
          </div>
          }

        </div>

        <!-- Error Display -->
        @if (hasError() && terminalState()?.error; as error) {
        <div class="bash-config-error">
          <atk-icon name="alert-circle" [size]="16" color="var(--color-danger-fg)"></atk-icon>
          <span class="error-message">{{ error }}</span>
          <button class="error-dismiss" (click)="executeAction('clear-error')">
            <atk-icon name="x" [size]="12" color="var(--color-fg-muted)"></atk-icon>
          </button>
        </div>
        }

        <!-- Footer Actions -->
        <footer class="bash-config-footer">
          <div class="footer-actions">
            <button class="footer-btn secondary" (click)="exportConfig()" [disabled]="isLoading()">
              <atk-icon name="download" [size]="14" color="currentColor"></atk-icon>
              Export
            </button>
            <button class="footer-btn warning" (click)="resetToDefaults()" [disabled]="isLoading()">
              <atk-icon name="rotate-ccw" [size]="14" color="currentColor"></atk-icon>
              Reset
            </button>
          </div>

          <!-- Quick Stats -->
          @if (terminalState()?.responseMetadata; as meta) {
          <div class="quick-stats">
            <div class="stat-item">
              <span class="stat-label">Records:</span>
              <span class="stat-value">{{ meta.dataCount || 0 }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Response:</span>
              <span class="stat-value">{{ meta.responseTime || 0 }}ms</span>
            </div>
          </div>
          }
        </footer>

      </div>
    </div>
  </div>
</aside>
