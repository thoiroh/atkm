<!-- src/app/shared/components/atk-bash/atk-bash.component.html -->
<!-- Simplified template without cursor tracking -->

<div class="terminal-wrapper">
  <header class="terminal-header">
    @if (currentConfig(); as config) {
    <h1>{{ config.title }}</h1>
    <div class="terminal-details">
      <h2>{{ config.subtitle }}</h2>
    </div>
    }
  </header>

  <main class="terminal-main">
    <!-- Terminal Section -->
    <div class="terminal-section">
      <div class="terminal-content">
        <!-- Simplified Terminal Status Bar -->
        <div class="terminal-status">
          <span class="status-indicator" [class]="terminalState().connectionStatus">
            {{ getStatusIcon(terminalState().connectionStatus) }}
            {{ terminalState().connectionStatus | titlecase }}
          </span>

          @if (isLoading()) {
          <span class="loading-indicator">
            <span class="spinner"></span>
            Loading...
          </span>
          }

          @if (terminalScrollState(); as scrollState) {
          <span class="scroll-info">
            Content: {{ scrollState.contentHeight }}px / Visible: {{ scrollState.visibleHeight }}px
          </span>
          }
        </div>

        <!-- Terminal textarea with simplified directive -->
        <textarea class="terminal-input" [style.--terminal-min-height]="currentConfig()?.terminal.height || '500px'"
          spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off"
          placeholder="Terminal ready... Type /help for commands" atkTerminalInput [autoResize]="false"
          [maxHeight]="currentConfig()?.terminal.height || '500px'" (contentChange)="onTerminalContentChange($event)"
          (scrollChange)="onTerminalScrollChange($event)">
        </textarea>
      </div>

      <!-- Terminal Command Panel -->
      @if (currentConfig()?.terminal.showControls !== false) {
      <div class="terminal-cmd">

        <!-- Endpoint Selection -->
        @if (currentConfig(); as config) {
        @if (config.endpoints.length > 1) {
        <div class="cmd-item">
          <label for="endpoint-select">API Endpoint</label>
          <select id="endpoint-select" class="cmd-select" [value]="currentEndpoint()"
            (change)="onEndpointChange($event)" [disabled]="isLoading()">

            @if (!currentEndpoint()) {
            <option value="" disabled>Select an endpoint...</option>
            }

            @for (endpoint of config.endpoints; track endpoint.id) {
            <option [value]="endpoint.id" [selected]="endpoint.id === currentEndpoint()">
              {{ endpoint.name }}
            </option>
            }
          </select>
        </div>
        }
        }

        <!-- Terminal Actions -->
        <div class="cmd-actions">
          <button class="cmd-btn cmd-btn-primary" (click)="executeEndpoint()"
            [disabled]="!currentEndpoint() || isLoading()">
            @if (isLoading()) {
            <span class="spinner small"></span>
            } @else {
            <atk-icon name="play" [size]="16" color="currentColor"></atk-icon>
            }
            Execute
          </button>

          <button class="cmd-btn cmd-btn-secondary" (click)="clearTerminal()" [disabled]="isLoading()">
            <atk-icon name="trash" [size]="16" color="currentColor"></atk-icon>
            Clear
          </button>

          <button class="cmd-btn cmd-btn-secondary" (click)="exportTerminalContent()" [disabled]="isLoading()">
            <atk-icon name="download" [size]="16" color="currentColor"></atk-icon>
            Export
          </button>
        </div>

        <!-- Terminal Stats -->
        @if (data().length > 0) {
        <div class="cmd-stats">
          <div class="stat-item">
            <span class="stat-label">Records:</span>
            <span class="stat-value">{{ data().length }}</span>
          </div>
          @if (terminalState().responseMetadata; as meta) {
          <div class="stat-item">
            <span class="stat-label">Response:</span>
            <span class="stat-value">{{ meta.responseTime }}ms</span>
          </div>
          }
        </div>
        }

        <!-- Error Display -->
        @if (hasError() && error(); as errorMsg) {
        <div class="cmd-error">
          <atk-icon name="alert-circle" [size]="16" color="var(--color-danger-fg)"></atk-icon>
          <span>{{ errorMsg }}</span>
        </div>
        }
      </div>
      }
    </div>
  </main>
</div>
